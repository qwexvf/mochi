-module(mochi@codegen@sdl).
-compile([no_auto_import, nowarn_unused_vars, nowarn_unused_function, nowarn_nomatch, inline]).
-define(FILEPATH, "src/mochi/codegen/sdl.gleam").
-export([default_config/0, generate_with_config/2, generate/1]).
-export_type([config/0]).

-if(?OTP_RELEASE >= 27).
-define(MODULEDOC(Str), -moduledoc(Str)).
-define(DOC(Str), -doc(Str)).
-else.
-define(MODULEDOC(Str), -compile([])).
-define(DOC(Str), -compile([])).
-endif.

-type config() :: {config,
        boolean(),
        boolean(),
        binary(),
        gleam@option:option(binary())}.

-file("src/mochi/codegen/sdl.gleam", 37).
?DOC(" Default configuration\n").
-spec default_config() -> config().
default_config() ->
    {config,
        true,
        false,
        <<"  "/utf8>>,
        {some,
            <<"# Generated by mochi\n# https://github.com/qwexvf/mochi"/utf8>>}}.

-file("src/mochi/codegen/sdl.gleam", 341).
-spec generate_schema_definition(mochi@schema:schema()) -> binary().
generate_schema_definition(Schema) ->
    Fields = [],
    Fields@1 = case erlang:element(2, Schema) of
        {some, Q} ->
            [<<"  query: "/utf8, (erlang:element(2, Q))/binary>> | Fields];

        none ->
            Fields
    end,
    Fields@2 = case erlang:element(3, Schema) of
        {some, M} ->
            [<<"  mutation: "/utf8, (erlang:element(2, M))/binary>> | Fields@1];

        none ->
            Fields@1
    end,
    Fields@3 = case erlang:element(4, Schema) of
        {some, S} ->
            [<<"  subscription: "/utf8, (erlang:element(2, S))/binary>> |
                Fields@2];

        none ->
            Fields@2
    end,
    <<<<"schema {\n"/utf8,
            (gleam@string:join(lists:reverse(Fields@3), <<"\n"/utf8>>))/binary>>/binary,
        "\n}"/utf8>>.

-file("src/mochi/codegen/sdl.gleam", 383).
-spec escape_string(binary()) -> binary().
escape_string(S) ->
    _pipe = S,
    _pipe@1 = gleam@string:replace(_pipe, <<"\\"/utf8>>, <<"\\\\"/utf8>>),
    _pipe@2 = gleam@string:replace(_pipe@1, <<"\""/utf8>>, <<"\\\""/utf8>>),
    gleam@string:replace(_pipe@2, <<"\n"/utf8>>, <<"\\n"/utf8>>).

-file("src/mochi/codegen/sdl.gleam", 366).
-spec generate_description(gleam@option:option(binary()), binary(), config()) -> binary().
generate_description(Description, Indent, Config) ->
    case {erlang:element(2, Config), Description} of
        {true, {some, Desc}} ->
            case gleam_stdlib:contains_string(Desc, <<"\n"/utf8>>) of
                true ->
                    <<<<<<<<<<<<Indent/binary, "\"\"\"\n"/utf8>>/binary,
                                        Indent/binary>>/binary,
                                    Desc/binary>>/binary,
                                "\n"/utf8>>/binary,
                            Indent/binary>>/binary,
                        "\"\"\"\n"/utf8>>;

                false ->
                    <<<<<<Indent/binary, "\""/utf8>>/binary,
                            (escape_string(Desc))/binary>>/binary,
                        "\"\n"/utf8>>
            end;

        {_, _} ->
            <<""/utf8>>
    end.

-file("src/mochi/codegen/sdl.gleam", 198).
-spec generate_scalar(mochi@schema:scalar_type(), config()) -> binary().
generate_scalar(Scalar, Config) ->
    Desc = generate_description(erlang:element(3, Scalar), <<""/utf8>>, Config),
    <<<<Desc/binary, "scalar "/utf8>>/binary,
        (erlang:element(2, Scalar))/binary>>.

-file("src/mochi/codegen/sdl.gleam", 203).
-spec generate_enum(mochi@schema:enum_type(), config()) -> binary().
generate_enum(Enum_type, Config) ->
    Desc = generate_description(
        erlang:element(3, Enum_type),
        <<""/utf8>>,
        Config
    ),
    Values = begin
        _pipe = maps:to_list(erlang:element(4, Enum_type)),
        _pipe@1 = gleam@list:map(
            _pipe,
            fun(Kv) ->
                {Name, Value_def} = Kv,
                Value_desc = generate_description(
                    erlang:element(3, Value_def),
                    erlang:element(4, Config),
                    Config
                ),
                Deprecated = case erlang:element(5, Value_def) of
                    true ->
                        case erlang:element(6, Value_def) of
                            {some, Reason} ->
                                <<<<" @deprecated(reason: \""/utf8,
                                        (escape_string(Reason))/binary>>/binary,
                                    "\")"/utf8>>;

                            none ->
                                <<" @deprecated"/utf8>>
                        end;

                    false ->
                        <<""/utf8>>
                end,
                <<<<<<Value_desc/binary, (erlang:element(4, Config))/binary>>/binary,
                        Name/binary>>/binary,
                    Deprecated/binary>>
            end
        ),
        gleam@string:join(_pipe@1, <<"\n"/utf8>>)
    end,
    <<<<<<<<<<Desc/binary, "enum "/utf8>>/binary,
                    (erlang:element(2, Enum_type))/binary>>/binary,
                " {\n"/utf8>>/binary,
            Values/binary>>/binary,
        "\n}"/utf8>>.

-file("src/mochi/codegen/sdl.gleam", 242).
-spec generate_union(mochi@schema:union_type(), config()) -> binary().
generate_union(Union, Config) ->
    Desc = generate_description(erlang:element(3, Union), <<""/utf8>>, Config),
    Type_names = begin
        _pipe = erlang:element(4, Union),
        _pipe@1 = gleam@list:map(_pipe, fun(T) -> erlang:element(2, T) end),
        gleam@string:join(_pipe@1, <<" | "/utf8>>)
    end,
    <<<<<<<<Desc/binary, "union "/utf8>>/binary,
                (erlang:element(2, Union))/binary>>/binary,
            " = "/utf8>>/binary,
        Type_names/binary>>.

-file("src/mochi/codegen/sdl.gleam", 390).
-spec field_type_to_sdl(mochi@schema:field_type()) -> binary().
field_type_to_sdl(Field_type) ->
    case Field_type of
        {non_null, Inner} ->
            <<(field_type_to_sdl(Inner))/binary, "!"/utf8>>;

        {list, Inner@1} ->
            <<<<"["/utf8, (field_type_to_sdl(Inner@1))/binary>>/binary,
                "]"/utf8>>;

        {named, Name} ->
            Name
    end.

-file("src/mochi/codegen/sdl.gleam", 253).
-spec generate_input_type(mochi@schema:input_object_type(), config()) -> binary().
generate_input_type(Input, Config) ->
    Desc = generate_description(erlang:element(3, Input), <<""/utf8>>, Config),
    Fields = begin
        _pipe = maps:to_list(erlang:element(4, Input)),
        _pipe@1 = gleam@list:map(
            _pipe,
            fun(Kv) ->
                {Name, Field_def} = Kv,
                Field_desc = generate_description(
                    erlang:element(3, Field_def),
                    erlang:element(4, Config),
                    Config
                ),
                <<<<<<<<Field_desc/binary, (erlang:element(4, Config))/binary>>/binary,
                            Name/binary>>/binary,
                        ": "/utf8>>/binary,
                    (field_type_to_sdl(erlang:element(4, Field_def)))/binary>>
            end
        ),
        gleam@string:join(_pipe@1, <<"\n"/utf8>>)
    end,
    <<<<<<<<<<Desc/binary, "input "/utf8>>/binary,
                    (erlang:element(2, Input))/binary>>/binary,
                " {\n"/utf8>>/binary,
            Fields/binary>>/binary,
        "\n}"/utf8>>.

-file("src/mochi/codegen/sdl.gleam", 325).
-spec generate_arguments(
    gleam@dict:dict(binary(), mochi@schema:argument_definition())
) -> binary().
generate_arguments(Arguments) ->
    _pipe = maps:to_list(Arguments),
    _pipe@1 = gleam@list:map(
        _pipe,
        fun(Kv) ->
            {Name, Arg_def} = Kv,
            Default = case erlang:element(5, Arg_def) of
                {some, _} ->
                    <<" = <default>"/utf8>>;

                none ->
                    <<""/utf8>>
            end,
            <<<<<<Name/binary, ": "/utf8>>/binary,
                    (field_type_to_sdl(erlang:element(4, Arg_def)))/binary>>/binary,
                Default/binary>>
        end
    ),
    gleam@string:join(_pipe@1, <<", "/utf8>>).

-file("src/mochi/codegen/sdl.gleam", 298).
-spec generate_field(mochi@schema:field_definition(), config()) -> binary().
generate_field(Field, Config) ->
    Desc = generate_description(
        erlang:element(3, Field),
        erlang:element(4, Config),
        Config
    ),
    Args = case maps:size(erlang:element(5, Field)) > 0 of
        true ->
            <<<<"("/utf8,
                    (generate_arguments(erlang:element(5, Field)))/binary>>/binary,
                ")"/utf8>>;

        false ->
            <<""/utf8>>
    end,
    Deprecated = case erlang:element(7, Field) of
        true ->
            case erlang:element(8, Field) of
                {some, Reason} ->
                    <<<<" @deprecated(reason: \""/utf8,
                            (escape_string(Reason))/binary>>/binary,
                        "\")"/utf8>>;

                none ->
                    <<" @deprecated"/utf8>>
            end;

        false ->
            <<""/utf8>>
    end,
    <<<<<<<<<<<<Desc/binary, (erlang:element(4, Config))/binary>>/binary,
                        (erlang:element(2, Field))/binary>>/binary,
                    Args/binary>>/binary,
                ": "/utf8>>/binary,
            (field_type_to_sdl(erlang:element(4, Field)))/binary>>/binary,
        Deprecated/binary>>.

-file("src/mochi/codegen/sdl.gleam", 228).
-spec generate_interface(mochi@schema:interface_type(), config()) -> binary().
generate_interface(Interface, Config) ->
    Desc = generate_description(
        erlang:element(3, Interface),
        <<""/utf8>>,
        Config
    ),
    Fields = begin
        _pipe = maps:to_list(erlang:element(4, Interface)),
        _pipe@1 = gleam@list:map(
            _pipe,
            fun(Kv) ->
                {_, Field_def} = Kv,
                generate_field(Field_def, Config)
            end
        ),
        gleam@string:join(_pipe@1, <<"\n"/utf8>>)
    end,
    <<<<<<<<<<Desc/binary, "interface "/utf8>>/binary,
                    (erlang:element(2, Interface))/binary>>/binary,
                " {\n"/utf8>>/binary,
            Fields/binary>>/binary,
        "\n}"/utf8>>.

-file("src/mochi/codegen/sdl.gleam", 273).
-spec generate_object_type(mochi@schema:object_type(), config()) -> binary().
generate_object_type(Object, Config) ->
    Desc = generate_description(erlang:element(3, Object), <<""/utf8>>, Config),
    Implements = case erlang:element(5, Object) of
        [] ->
            <<""/utf8>>;

        Interfaces ->
            Names = begin
                _pipe = Interfaces,
                _pipe@1 = gleam@list:map(
                    _pipe,
                    fun(I) -> erlang:element(2, I) end
                ),
                gleam@string:join(_pipe@1, <<" & "/utf8>>)
            end,
            <<" implements "/utf8, Names/binary>>
    end,
    Fields = begin
        _pipe@2 = maps:to_list(erlang:element(4, Object)),
        _pipe@3 = gleam@list:map(
            _pipe@2,
            fun(Kv) ->
                {_, Field_def} = Kv,
                generate_field(Field_def, Config)
            end
        ),
        gleam@string:join(_pipe@3, <<"\n"/utf8>>)
    end,
    <<<<<<<<<<<<Desc/binary, "type "/utf8>>/binary,
                        (erlang:element(2, Object))/binary>>/binary,
                    Implements/binary>>/binary,
                " {\n"/utf8>>/binary,
            Fields/binary>>/binary,
        "\n}"/utf8>>.

-file("src/mochi/codegen/sdl.gleam", 398).
-spec needs_schema_definition(mochi@schema:schema()) -> boolean().
needs_schema_definition(Schema) ->
    case {erlang:element(2, Schema),
        erlang:element(3, Schema),
        erlang:element(4, Schema)} of
        {{some, Q}, _, _} when erlang:element(2, Q) =/= <<"Query"/utf8>> ->
            true;

        {_, {some, M}, _} when erlang:element(2, M) =/= <<"Mutation"/utf8>> ->
            true;

        {_, _, {some, S}} when erlang:element(2, S) =/= <<"Subscription"/utf8>> ->
            true;

        {_, _, _} ->
            false
    end.

-file("src/mochi/codegen/sdl.gleam", 412).
-spec get_scalar_types(mochi@schema:schema(), config()) -> list(mochi@schema:scalar_type()).
get_scalar_types(Schema, Config) ->
    Builtin = [<<"String"/utf8>>,
        <<"Int"/utf8>>,
        <<"Float"/utf8>>,
        <<"Boolean"/utf8>>,
        <<"ID"/utf8>>],
    _pipe = maps:to_list(erlang:element(5, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {Name, Type_def} = Kv,
            case Type_def of
                {scalar_type_def, Scalar} ->
                    case erlang:element(3, Config) orelse not gleam@list:contains(
                        Builtin,
                        Name
                    ) of
                        true ->
                            {ok, Scalar};

                        false ->
                            {error, nil}
                    end;

                _ ->
                    {error, nil}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 430).
-spec get_enum_types(mochi@schema:schema()) -> list(mochi@schema:enum_type()).
get_enum_types(Schema) ->
    _pipe = maps:to_list(erlang:element(5, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {_, Type_def} = Kv,
            case Type_def of
                {enum_type_def, Enum} ->
                    {ok, Enum};

                _ ->
                    {error, nil}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 441).
-spec get_interface_types(mochi@schema:schema()) -> list(mochi@schema:interface_type()).
get_interface_types(Schema) ->
    _pipe = maps:to_list(erlang:element(5, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {_, Type_def} = Kv,
            case Type_def of
                {interface_type_def, Interface} ->
                    {ok, Interface};

                _ ->
                    {error, nil}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 452).
-spec get_union_types(mochi@schema:schema()) -> list(mochi@schema:union_type()).
get_union_types(Schema) ->
    _pipe = maps:to_list(erlang:element(5, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {_, Type_def} = Kv,
            case Type_def of
                {union_type_def, Union} ->
                    {ok, Union};

                _ ->
                    {error, nil}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 463).
-spec get_input_types(mochi@schema:schema()) -> list(mochi@schema:input_object_type()).
get_input_types(Schema) ->
    _pipe = maps:to_list(erlang:element(5, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {_, Type_def} = Kv,
            case Type_def of
                {input_object_type_def, Input} ->
                    {ok, Input};

                _ ->
                    {error, nil}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 474).
-spec get_object_types(mochi@schema:schema()) -> list(mochi@schema:object_type()).
get_object_types(Schema) ->
    _pipe = maps:to_list(erlang:element(5, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {_, Type_def} = Kv,
            case Type_def of
                {object_type_def, Obj} ->
                    {ok, Obj};

                _ ->
                    {error, nil}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 485).
-spec get_custom_directives(mochi@schema:schema()) -> list(mochi@schema:directive_definition()).
get_custom_directives(Schema) ->
    Builtin = [<<"skip"/utf8>>, <<"include"/utf8>>, <<"deprecated"/utf8>>],
    _pipe = maps:to_list(erlang:element(6, Schema)),
    gleam@list:filter_map(
        _pipe,
        fun(Kv) ->
            {Name, Directive} = Kv,
            case gleam@list:contains(Builtin, Name) of
                true ->
                    {error, nil};

                false ->
                    {ok, Directive}
            end
        end
    ).

-file("src/mochi/codegen/sdl.gleam", 501).
-spec generate_directive(mochi@schema:directive_definition(), config()) -> binary().
generate_directive(Directive, Config) ->
    Desc = generate_description(
        erlang:element(3, Directive),
        <<""/utf8>>,
        Config
    ),
    Args = case maps:size(erlang:element(4, Directive)) > 0 of
        true ->
            <<<<"("/utf8,
                    (generate_arguments(erlang:element(4, Directive)))/binary>>/binary,
                ")"/utf8>>;

        false ->
            <<""/utf8>>
    end,
    Repeatable = case erlang:element(6, Directive) of
        true ->
            <<" repeatable"/utf8>>;

        false ->
            <<""/utf8>>
    end,
    Locations = begin
        _pipe = erlang:element(5, Directive),
        _pipe@1 = gleam@list:map(
            _pipe,
            fun mochi@schema:directive_location_to_string/1
        ),
        gleam@string:join(_pipe@1, <<" | "/utf8>>)
    end,
    <<<<<<<<<<<<Desc/binary, "directive @"/utf8>>/binary,
                        (erlang:element(2, Directive))/binary>>/binary,
                    Args/binary>>/binary,
                Repeatable/binary>>/binary,
            " on "/utf8>>/binary,
        Locations/binary>>.

-file("src/mochi/codegen/sdl.gleam", 56).
?DOC(" Generate SDL with custom config\n").
-spec generate_with_config(mochi@schema:schema(), config()) -> binary().
generate_with_config(Schema, Config) ->
    Parts = [],
    Parts@1 = case erlang:element(5, Config) of
        {some, Header} ->
            [Header, <<""/utf8>>];

        none ->
            Parts
    end,
    Scalar_types = get_scalar_types(Schema, Config),
    Parts@2 = case Scalar_types of
        [] ->
            Parts@1;

        _ ->
            Scalars_sdl = begin
                _pipe = Scalar_types,
                _pipe@1 = gleam@list:map(
                    _pipe,
                    fun(S) -> generate_scalar(S, Config) end
                ),
                gleam@string:join(_pipe@1, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@1, [Scalars_sdl, <<""/utf8>>])
    end,
    Enum_types = get_enum_types(Schema),
    Parts@3 = case Enum_types of
        [] ->
            Parts@2;

        _ ->
            Enums_sdl = begin
                _pipe@2 = Enum_types,
                _pipe@3 = gleam@list:map(
                    _pipe@2,
                    fun(E) -> generate_enum(E, Config) end
                ),
                gleam@string:join(_pipe@3, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@2, [Enums_sdl, <<""/utf8>>])
    end,
    Interface_types = get_interface_types(Schema),
    Parts@4 = case Interface_types of
        [] ->
            Parts@3;

        _ ->
            Interfaces_sdl = begin
                _pipe@4 = Interface_types,
                _pipe@5 = gleam@list:map(
                    _pipe@4,
                    fun(I) -> generate_interface(I, Config) end
                ),
                gleam@string:join(_pipe@5, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@3, [Interfaces_sdl, <<""/utf8>>])
    end,
    Union_types = get_union_types(Schema),
    Parts@5 = case Union_types of
        [] ->
            Parts@4;

        _ ->
            Unions_sdl = begin
                _pipe@6 = Union_types,
                _pipe@7 = gleam@list:map(
                    _pipe@6,
                    fun(U) -> generate_union(U, Config) end
                ),
                gleam@string:join(_pipe@7, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@4, [Unions_sdl, <<""/utf8>>])
    end,
    Input_types = get_input_types(Schema),
    Parts@6 = case Input_types of
        [] ->
            Parts@5;

        _ ->
            Inputs_sdl = begin
                _pipe@8 = Input_types,
                _pipe@9 = gleam@list:map(
                    _pipe@8,
                    fun(I@1) -> generate_input_type(I@1, Config) end
                ),
                gleam@string:join(_pipe@9, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@5, [Inputs_sdl, <<""/utf8>>])
    end,
    Object_types = get_object_types(Schema),
    Parts@7 = case Object_types of
        [] ->
            Parts@6;

        _ ->
            Objects_sdl = begin
                _pipe@10 = Object_types,
                _pipe@11 = gleam@list:map(
                    _pipe@10,
                    fun(O) -> generate_object_type(O, Config) end
                ),
                gleam@string:join(_pipe@11, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@6, [Objects_sdl, <<""/utf8>>])
    end,
    Parts@8 = case erlang:element(2, Schema) of
        {some, Query_type} ->
            Query_sdl = generate_object_type(Query_type, Config),
            lists:append(Parts@7, [Query_sdl, <<""/utf8>>]);

        none ->
            Parts@7
    end,
    Parts@9 = case erlang:element(3, Schema) of
        {some, Mutation_type} ->
            Mutation_sdl = generate_object_type(Mutation_type, Config),
            lists:append(Parts@8, [Mutation_sdl, <<""/utf8>>]);

        none ->
            Parts@8
    end,
    Parts@10 = case erlang:element(4, Schema) of
        {some, Subscription_type} ->
            Subscription_sdl = generate_object_type(Subscription_type, Config),
            lists:append(Parts@9, [Subscription_sdl, <<""/utf8>>]);

        none ->
            Parts@9
    end,
    Parts@11 = case needs_schema_definition(Schema) of
        true ->
            lists:append(
                Parts@10,
                [generate_schema_definition(Schema), <<""/utf8>>]
            );

        false ->
            Parts@10
    end,
    Custom_directives = get_custom_directives(Schema),
    Parts@12 = case Custom_directives of
        [] ->
            Parts@11;

        _ ->
            Directives_sdl = begin
                _pipe@12 = Custom_directives,
                _pipe@13 = gleam@list:map(
                    _pipe@12,
                    fun(D) -> generate_directive(D, Config) end
                ),
                gleam@string:join(_pipe@13, <<"\n\n"/utf8>>)
            end,
            lists:append(Parts@11, [Directives_sdl, <<""/utf8>>])
    end,
    _pipe@14 = Parts@12,
    _pipe@15 = gleam@string:join(_pipe@14, <<"\n"/utf8>>),
    gleam@string:trim(_pipe@15).

-file("src/mochi/codegen/sdl.gleam", 51).
?DOC(" Generate SDL from a schema with default config\n").
-spec generate(mochi@schema:schema()) -> binary().
generate(Schema) ->
    generate_with_config(Schema, default_config()).
